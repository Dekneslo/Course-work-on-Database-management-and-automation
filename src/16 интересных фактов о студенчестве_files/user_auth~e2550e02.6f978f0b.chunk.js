(this.webpackJsonpnewvm=this.webpackJsonpnewvm||[]).push([[17],{133:function(e,r,t){"use strict";t.r(r),t.d(r,"Auth",(function(){return u}));var a=t(1),n=t.n(a),o=t(3),i=t(4),s=t(2),c=t(0),l=t(52),u=function e(r){var t=this;Object(i.a)(this,e),this.bindEvents=function(){t.$modal.addEventListener("click",(function(e){if(e.target.matches(".btn-social")){var r=e.target.getAttribute("name"),a=t.onSocialAuth(r);a&&window.open(a)}})),t.$modal.querySelector("form").addEventListener("submit",function(){var e=Object(o.a)(n.a.mark((function e(r){var a,o,i,u,d;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),(a=r.target.querySelector(".alert"))&&a.remove(),o=r.target.querySelector('input[name="email"]'),i=r.target.querySelector('input[name="password"]'),u=!1,""!==o.value&&l.a.validateEmail(o.value)?o.classList.remove("error"):(u=!0,o.classList.add("error")),""===i.value?i.classList.add("error"):i.classList.remove("error"),!1!==u){e.next=22;break}return t.$modal.classList.add("loading"),e.prev=10,e.next=13,t.userAuthorization(o.value,i.value);case 13:"Error"===(d=e.sent).result?(window.VM.Logger.error("user authorization error ",d),t.$modal.classList.remove("loading"),r.target.innerHTML=r.target.innerHTML+'<div class="alert error">\u041d\u0435 \u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c</div>'):(c.a.set(s.a.USER.token,d.data.access_token),window.location.reload()),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(10),window.VM.Logger.error("user authorization error ",e.t0),t.$modal.classList.remove("loading"),e.t0.target.innerHTML=e.t0.target.innerHTML+'<div class="alert error">\u041d\u0435 \u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c</div>';case 22:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(r){return e.apply(this,arguments)}}()),t.$modalForgot.querySelector("form").addEventListener("submit",function(){var e=Object(o.a)(n.a.mark((function e(r){var a,o,i,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),(a=r.target.querySelector(".alert"))&&a.remove(),o=r.target.querySelector('input[name="email"]'),i=!1,""!==o.value||l.a.validateEmail(o.value)?o.classList.remove("error"):(i=!0,o.classList.add("error")),!1!==i){e.next=20;break}return t.$modalForgot.classList.add("loading"),e.prev=8,e.next=11,t.userRecover(o.value);case 11:"Error"===(s=e.sent).result?(window.VM.Logger.error("user recover error ",s),t.$modalForgot.classList.remove("loading"),r.target.innerHTML=r.target.innerHTML+'<div class="alert error">\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0432\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u043c email \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d</div>'):(t.$modalForgot.classList.remove("loading"),r.target.innerHTML=r.target.innerHTML+'<div class="alert success">\u041d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u0412\u0430\u043c \u043d\u0430 \u043f\u043e\u0447\u0442\u0443</div>'),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(8),window.VM.Logger.error("user recover error ",e.t0),t.$modalForgot.classList.remove("loading"),e.t0.target.innerHTML=e.t0.target.innerHTML+'<div class="alert error">\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0432\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u043c email \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d</div>';case 20:case"end":return e.stop()}}),e,null,[[8,15]])})));return function(r){return e.apply(this,arguments)}}()),t.$modalRegistration.querySelector("form").addEventListener("submit",function(){var e=Object(o.a)(n.a.mark((function e(r){var a,o,i,s,c,u,d;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),(a=r.target.querySelector(".alert"))&&a.remove(),o=r.target.querySelector('input[name="email"]'),i=r.target.querySelector('input[name="password"]'),s=r.target.querySelector('input[name="repeat_password"]'),c=r.target.querySelector('input[name="subscribe"]'),u=!1,""!==o.value||l.a.validateEmail(o.value)?o.classList.remove("error"):(u=!0,o.classList.add("error")),""===i.value?(u=!0,i.classList.add("error")):i.classList.remove("error"),i.value!==s.value?(u=!0,i.classList.add("error"),s.classList.add("error")):(i.classList.remove("error"),s.classList.remove("error")),!1!==u){e.next=26;break}return t.$modalRegistration.classList.add("loading"),e.prev=13,e.next=16,t.userRegistration(o.value,i.value,c.checked);case 16:d=e.sent,t.$modalRegistration.classList.remove("loading"),"Error"===d.result?(window.VM.Logger.error("user reg error ",d),t.$modalRegistration.classList.remove("loading"),"Email already exists"===d.error?r.target.innerHTML=r.target.innerHTML+'<div class="alert error">\u041e\u0448\u0438\u0431\u043a\u0430: \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d \u043d\u0430 \u0441\u0430\u0439\u0442\u0435</div>':r.target.innerHTML=r.target.innerHTML+'<div class="alert error">\u041e\u0448\u0438\u0431\u043a\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438</div>'):(t.$modalRegistration.classList.remove("loading"),r.target.innerHTML=r.target.innerHTML+'<div class="alert success">\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e. \u041d\u0430 email: '.concat(o.value," \u0431\u044b\u043b\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u0434\u043b\u044f \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f</div>")),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(13),window.VM.Logger.error("user reg error ",e.t0),t.$modalRegistration.classList.remove("loading"),e.t0.target.innerHTML=e.t0.target.innerHTML+'<div class="alert error">\u041e\u0448\u0438\u0431\u043a\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438</div>';case 26:case"end":return e.stop()}}),e,null,[[13,21]])})));return function(r){return e.apply(this,arguments)}}())},this.userRecover=function(e){return new Promise((function(r,t){fetch("/profile/recover",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({email:e})}).then((function(e){return e.json()})).then((function(e){r(e)})).catch((function(e){t(e)}))}))},this.userRegistration=function(e,r,t){return new Promise((function(a,n){var o={email:e,login:e,password:r,options:{}};t&&(o.options.EMAIL_EVERY_WEEK=!0),fetch("/profile/registration",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(o)}).then((function(e){return e.json()})).then((function(e){a(e)})).catch((function(e){n(e)}))}))},this.userAuthorization=function(e,r){return new Promise((function(t,a){fetch("/profile/auth",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({email:e,password:r})}).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){a(e)}))}))},this.onSocialAuth=function(e){switch(e){case"fb_auth":return"https://www.facebook.com/dialog/oauth?client_id=".concat(s.a.SOCIAL.fb,"&scope=email&redirect_uri=").concat(encodeURIComponent(s.a.SOCIAL_LOGIN+"fb"),"&state=700dd0f304bc3e216dda0bce73a0b002");case"vk_auth":return"http://oauth.vk.com/authorize?client_id=".concat(s.a.SOCIAL.vk,"&display=page&redirect_uri=").concat(encodeURIComponent(s.a.SOCIAL_LOGIN+"vk"));case"tw_auth":return"/profile/login/twredirect";case"ok_auth":return"http://www.odnoklassniki.ru/oauth/authorize?client_id=".concat(s.a.SOCIAL.ok,"&response_type=code&redirect_uri=").concat(encodeURIComponent(s.a.SOCIAL_LOGIN+"ok"));default:return window.VM.Logger.error("incorrect social network",{social:e}),""}},this.$modal=r.modal,this.$modalRegistration=document.getElementById("user_reg_modal"),this.$modalForgot=document.getElementById("user_forgot_modal"),this.bindEvents()}},52:function(e,r,t){"use strict";r.a={validateEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}}}}]);